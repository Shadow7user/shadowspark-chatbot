[34m
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Phase 1D Enterprise Hardening Test Suite â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m

[34mâ•â•â• Environment Validation Tests â•â•â•[0m
[34mâ„¹[0m Testing environment configuration...
âœ… Configuration loaded successfully (development mode)
[32mâœ“[0m Environment configuration loaded successfully
[34mâ„¹[0m Testing required environment variables...
[32mâœ“[0m All required environment variables present
[34mâ„¹[0m Testing production environment requirements...
[34mâ„¹[0m Running in development mode - production checks skipped
[34mâ„¹[0m Testing Twilio WhatsApp number format...
[32mâœ“[0m Twilio number format correct: whatsapp:+14155238886

[34mâ•â•â• Database Schema Tests â•â•â•[0m
[34mâ„¹[0m Testing ClientConfig schema...
[32mâœ“[0m ClientConfig has all token tracking fields
[34mâ„¹[0m Testing Conversation status enum...
[32mâœ“[0m Conversation status enum includes: ACTIVE, PAUSED, HANDOFF, CLOSED
[34mâ„¹[0m Testing Message deduplication field...
[32mâœ“[0m Message has channelMessageId field for deduplication

[34mâ•â•â• Token Tracking Tests â•â•â•[0m
[34mâ„¹[0m Testing checkTokenCap()...
[32mâœ“[0m checkTokenCap() returns valid structure: {"exceeded":false,"currentUsage":248,"cap":null,"remaining":null}
[34mâ„¹[0m Testing getTokenUsage()...
[32mâœ“[0m getTokenUsage() returns current usage: 248 tokens
[34mâ„¹[0m Testing incrementTokenUsage()...
[32mâœ“[0m incrementTokenUsage() correctly incremented: 248 â†’ 348
[34mâ„¹[0m Testing month reset logic...
[00:03:06.630] [32mINFO[39m (25539): [36mIncremented token usage for client shadowspark-demo: +100 tokens (total: 348)[39m
[32mâœ“[0m Month tracking correct: 2026-02
[34mâ„¹[0m Testing token cap enforcement...
[33mâš [0m No token cap set (unlimited usage allowed)

[34mâ•â•â• Handoff Logic Tests â•â•â•[0m
[34mâ„¹[0m Testing handoff keyword detection...
[32mâœ“[0m Handoff keyword pattern correct (7/7 tests passed)
[34mâ„¹[0m Testing ConversationStatus enum...
[32mâœ“[0m ConversationStatus enum working: ACTIVE

[34mâ•â•â• Security Features Tests â•â•â•[0m
[34mâ„¹[0m Testing admin secret protection...
[32mâœ“[0m Admin secret protection working (401 Unauthorized)
[34mâ„¹[0m Testing health endpoint...
[32mâœ“[0m Health endpoint accessible and working
[34mâ„¹[0m Testing webhook endpoint...
[32mâœ“[0m Webhook endpoint accepts POST requests

[34mâ•â•â• Test Summary â•â•â•[0m
[32mâœ“ Passed:[0m   16
[31mâœ— Failed:[0m   0
[33mâš  Warnings:[0m 1

[34mOverall:[0m 100.0% tests passed (16/16)

[32mâœ“ All critical tests passed! Phase 1D implementation verified.[0m

